---
title: Create a Cluster
owner: PKS
---

<strong><%= modified_date %></strong>

This topic describes how to create a Kubernetes cluster with Pivotal Container Service (PKS) using the PKS Command Line Interface (CLI).

## <a id='cluster-access'></a>Configure Cluster Access

When you create a cluster, you must configure external access to the cluster by creating an external TCP or HTTPS load balancer.
Create the load balancer before you create the cluster, then point the load balancer to the IP address of the master virtual machine (VM) after cluster creation.

You can configure any load balancer of your choice.
If you use vSphere with NSX-T or GCP, you can create a load balancer using your cloud provider console.

If you are creating a cluster in a non-production environment, you can choose to create a cluster without a load balancer.
Create a DNS entry that points to the cluster's master VM after cluster creation.

## <a id='create'></a>Create a Kubernetes Cluster

Perform the following steps:

1. Grant cluster access to a new or existing user in UAA.
See the [Grant Cluster Access to a User](manage-users.html#uaa-scopes) section of _Manage Users in UAA_ for more information.

1. <%= partial 'login-pks-api' %>

1. Run the following command to create a cluster:
  <pre>
  pks create-cluster CLUSTER-NAME \
  --external-hostname HOSTNAME \
  --plan PLAN-NAME \
  [--num-nodes WORKER-NODES]
  </pre>
  Replace the placeholder values in the command as follows:
  * `CLUSTER-NAME`: Enter a unique name for your cluster.
  * `HOSTNAME`: Enter an external hostname for your cluster. You can use any fully qualified domain name (FQDN) or IP address you own.
  For example, `my-cluster.example.com` or `10.0.0.1`.
  * `PLAN-NAME`: Choose a plan for your cluster. Run `pks plans` to list your available plans.
  * (Optional) `WORKER-NODES`: Choose the number of worker nodes for the cluster.
  If you do not specify a number of worker nodes, the default value is 3.
  For high availability, Pivotal recommends creating clusters with at least 3 worker nodes.
  The maximum value is 50.
    <br><br>
    For example:
    <pre class="terminal">$ pks create-cluster my-cluster \
    --external-hostname my-cluster.example.com \
    --plan large --num-nodes 3</pre>

1. Track the cluster creation process by running `pks cluster CLUSTER-NAME`.
Replace `CLUSTER-NAME` with the unique name for your cluster. For example:
  <pre class="terminal">$ pks cluster my-cluster
  Name:                     my-cluster
  Plan Name:                large
  UUID:                     01a234bc-d56e-7f89-01a2-3b4cde5f6789
  Last Action:              CREATE
  Last Action State:        succeeded
  Last Action Description:  Instance provisioning completed
  Kubernetes Master Host:   my-cluster.example.com
  Kubernetes Master Port:   8443
  Worker Instances:         3
  Kubernetes Master IP(s):  192.168.20.7
</pre>
  If the value for **Last Action State** is `error`, troubleshoot cluster creation by logging in to the BOSH Director and running `bosh tasks`.
  See [Advanced Troubleshooting with the BOSH CLI](https://docs.pivotal.io/pivotalcf/customizing/trouble-advanced.html) for more information.

1. Configure external access to the cluster's master node using either a DNS record or an external load balancer.
Use the output from the `pks cluster` command to locate the master node IP address.

1. To access your cluster, run `pks get-credentials CLUSTER-NAME`.
This command creates a local `kubeconfig` that allows you to manage the cluster.
See [Retrieve Cluster Credentials and Configuration](cluster-credentials.html) for more information.

1. Run `kubectl cluster-info` to confirm you can access your cluster using the Kubernetes CLI.

##<a id="cluster-create-lb"></a>Creating a Cluster with a GCE Load Balancer

In order to use a GCE load balancer with a cluster, you must specify that you wish to use a load balancer during cluster creation. You cannot add a load balancer to an existing cluster. 

Before completing this procedure, create a GCE load balancer and related firewall rules by following the procedures in [Configure a GCE Load Balancer for PKS Clusters](./gce-cluster-load-balancer.html).

1. Log in to the PKS CLI.
2. Enter `pks list-plans`.
3. Choose a plan. This is the plan on which you will create a cluster with a GCE load balancer.
<p class="note"><strong>Note</strong>: You must have already created a GCE load balancer before continuing this procedure.</p>
4. Create a cluster on this plan and connect the load balancer you created in [Configure a GCE Load Balancer for PKS Clusters](./gce-cluster-load-balancer.html). Example code follows: `pks create-cluster YOUR-CLUSTER-NAME --external-hostname YOUR-LOAD-BALANCER-IP --plan small --num-nodes 3`
4. Wait while the cluster is created. To check the creation progress, enter the following command in the BOSH CLI of the Ops Manager instance: `bosh -e pks task`.
<p class="note"><strong>Note</strong>: This errand may run after the deployment. Depending on what other tasks you have queued, several BOSH tasks may run at this time.

##<a id="lb-connect"></a> Connecting a GCE Load Balancer to a Cluster

Once you have created a new cluster with a load balancer, you must connect the load balancer to the master instance of the cluster. This ensures that traffic is distributed when accessing the cluster, and that any firewall rules you created take effect.

1. Search for the master VM ID by either entering `bosh -e pks vms` or logging into the GCP Console and navigating to **Compute Engine** > **VM Instances**, and searching for the master instance there.
1. In Google Compute Engine, navigate to **Network services** > **Load balancing**. 
1. Click the name of the load balancer you created in the [Creating Load Balancers for PKS Clusters](gce-cluster-load-balancer.html/#create) section of *Configure a GCE Load Balancer for PKS Clusters*. The *Load balancer details* screen opens.
1. Click **Edit**.
1. In the *Backend configuration* panel, add the ???????????.
1. In the Google Compute Engine, navigate to **VM Instances** and search for the master instance.
1. Click the name of the master instance.
1. Click **Edit**.
1. In the *Network tags* section, add the `your-pks-cluster-api-tag` network tag. This funnels traffic through the load balancer and into the cluster.
1. Click **Save**.

##<a id="next"></a> Next Steps

See [Managing PKS](managing.html) for information about checking cluster health and viewing cluster logs.
