---
title: Preparing to Deploy PKS on vSphere
owner: Ops Manager
---

<strong><%= modified_date %></strong>

This guide describes the preparation steps required to install Pivotal Container Service (PKS) on VMware vSphere.

Follow these procedures to prepare your vSphere environment.

## <a id='service-account'></a>Step 1: Create a Service Account

In order for Kubernetes to create load balancers and attach persistent disks to pods,
you must create a service account in vCenter with sufficient permissions.
For a full list of the permissions that BOSH requires in order to deploy Ops Manager,
see [vSphere Service Account Requirements](https://docs.pivotal.io/pivotalcf/2-0/customizing/vsphere-service-account.html).

<p class="note"><strong>Note</strong>: You can also apply the default <a href="http://pubs.vmware.com/vsphere-51/index.jsp#com.vmware.wssdk.pg.doc/PG_Authenticate_Authorize.8.6.html#1110514">VMware Administrator System Role</a>
to the service account to achieve the appropriate permission level.</p>

## <a id='deploy-om'></a>Step 2: Deploy Ops Manager

Complete the procedures in [Deploying BOSH and Ops Manager to vSphere](https://docs.pivotal.io/pivotalcf/2-0/customizing/deploying-vm.html).

<p class="note"><strong>Note</strong>: If you have Pivotal Application Service (PAS) installed, Pivotal recommends installing PKS on a separate instance of Ops Manager v2.0.</p>

## <a id='deploy-om'></a>Step 3: Configure Ops Manager

1. Complete the procedures in [Configuring Ops Manager on vSphere](https://docs.pivotal.io/pivotalcf/2-0/customizing/vsphere-config.html).

1. Verify the following Ops Manager settings:
    * Ensure that **Enable Post Deploy Scripts** on the **Director Config** page is enabled.
      <p class="note"><strong>Note</strong>: This setting enables post-deploy scripts for all tiles in your Ops Manager installation.</p>
    * Ensure that BOSH DNS is enabled. If you disabled BOSH DNS, you must re-enable it and redeploy PCF.
      <p class="note"><strong>Note</strong>: BOSH DNS must be enabled in all PKS deployments. If PAS and PKS are running on the same instance of Ops Manager, you cannot use the opt-out feature of BOSH DNS for your PAS without breaking PKS. If you want to opt out of BOSH DNS in your PAS deployment, install the tile on a separate instance of Ops Manager. For more information about opting out of BOSH DNS, see <a href="https://discuss.pivotal.io/hc/en-us/articles/115015720428-Disabling-or-Opting-Out-of-BOSH-DNS-in-PCF">this KB article</a> and <a href="https://docs.pivotal.io/pivotalcf/2-0/pcf-release-notes/opsmanager-rn.html#bosh-dns">Ops Manager v2.0 Release Notes</a>.</p>

1. From the **Create Networks** tab, create the following two networks for PKS:

    <table>
      <tr>
        <th rowspan="6" width="21%">Main Network</th>
        <td><strong>Name</strong></td>
        <td>pks-main</td>
      </tr>
      <tr>
        <td><strong>vSphere Network</strong></td>
        <td>VM Network</td>
      </tr>
      <tr>
        <td><strong>CIDR</strong></td>
        <td>10.191.52.0/24</td>
      </tr>
      <tr>
        <td><strong>Gateway</strong></td>
        <td>10.191.52.1</td>
      </tr>
      <tr>
        <td><strong>DNS</strong></td>
        <td>10.191.52.2</td>
      </tr>
      <tr>
        <td><strong>Reserved</strong></td>
        <td>10.191.52.1-10.191.52.99,10.191.52.120-10.191.52.255</td>
      </tr>
      <tr>
        <th rowspan="6">Service Network</th>
        <td><strong>Name</strong></td>
        <td>pks-services</td>
      </tr>
      <tr>
        <td><strong>vSphere Network</strong></td>
        <td>VM Network</td>
      </tr>
      <tr>
        <td><strong>CIDR</strong></td>
        <td>10.193.52.0/24</td>
      </tr>
      <tr>
        <td><strong>Gateway</strong></td>
        <td>10.193.52.1</td>
      </tr>
      <tr>
        <td><strong>DNS</strong></td>
        <td>10.193.52.2</td>
      </tr>
      <tr>
        <td><strong>Reserved</strong></td>
        <td>10.193.52.1-10.193.52.119,10.193.52.240-10.193.52.255</td>
      </tr>
    </table>

## <a id='next-steps'></a>Next Steps

If you are installing PKS to vSphere **with** NSX-T, follow the procedures in [Installing and Configuring PKS with NSX-T Integration](installing-nsx-t.html).

If you are installing PKS to vSphere **without** NSX-T, follow the procedures in [Installing and Configuring PKS](installing.html).

